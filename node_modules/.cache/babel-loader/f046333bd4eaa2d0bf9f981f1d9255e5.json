{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nimport { stringify } from 'query-string';\nimport { fetchUtils } from 'ra-core';\n/**\n * Maps react-admin queries to a postgrest REST API\n *\n * This REST dialect uses postgrest syntax\n *\n * @see https://postgrest.org/en/v6.0/api.html#embedded-filters\n *\n * @example\n *\n * getList          => GET    http://my.api.url/posts?order=title.asc&offset=0&limit=24&filterField=eq.value\n * getOne           => GET    http://my.api.url/posts?id=eq.123\n * getMany          => GET    http://my.api.url/posts?id=in.(123,456,789)\n * getManyReference => GET    http://my.api.url/posts?author_id=eq.345\n * create           => POST   http://my.api.url/posts\n * update           => PATCH  http://my.api.url/posts?id=eq.123\n * updateMany       => PATCH  http://my.api.url/posts?id=in.(123,456,789)\n * delete           => DELETE http://my.api.url/posts?id=eq.123\n * deleteMany       => DELETE http://my.api.url/posts?id=in.(123,456,789)\n *\n * @example\n *\n * import React from 'react';\n * import { Admin, Resource } from 'react-admin';\n * import postgrestRestProvider from '@raphiniert/ra-data-postgrest';\n *\n * import { PostList } from './posts';\n *\n * const App = () => (\n *     <Admin dataProvider={postgrestRestProvider('http://path.to.my.api/')}>\n *         <Resource name=\"posts\" list={PostList} />\n *     </Admin>\n * );\n *\n * export default App;\n */\n\nfunction parseFilters(filter, defaultListOp) {\n  var result = {};\n  Object.keys(filter).forEach(function (key) {\n    // key: the name of the object key\n    var splitKey = key.split('@');\n    var operation = splitKey.length == 2 ? splitKey[1] : defaultListOp;\n    var values;\n\n    if (operation.includes('like')) {\n      // we split the search term in words\n      values = filter[key].trim().split(' ');\n    } else {\n      values = [filter[key]];\n    }\n\n    values.forEach(function (value) {\n      var op = operation.includes('like') ? operation + \".*\" + value + \"*\" : operation + \".\" + value;\n\n      if (result[splitKey[0]] === undefined) {\n        // first operator for the key, we add it to the dict\n        result[splitKey[0]] = op;\n      } else {\n        if (!Array.isArray(result[splitKey[0]])) {\n          // second operator, we transform to an array\n          result[splitKey[0]] = [result[splitKey[0]], op];\n        } else {\n          // third and subsequent, we add to array\n          result[splitKey[0]].push(op);\n        }\n      }\n    });\n  });\n  return result;\n}\n\nexport default (function (apiUrl, httpClient, defaultListOp) {\n  if (httpClient === void 0) {\n    httpClient = fetchUtils.fetchJson;\n  }\n\n  if (defaultListOp === void 0) {\n    defaultListOp = 'eq';\n  }\n\n  return {\n    getList: function (resource, params) {\n      var _a = params.pagination,\n          page = _a.page,\n          perPage = _a.perPage;\n      var _b = params.sort,\n          field = _b.field,\n          order = _b.order;\n      var parsedFilter = parseFilters(params.filter, defaultListOp);\n\n      var query = __assign({\n        order: field + \".\" + order.toLowerCase(),\n        offset: (page - 1) * perPage,\n        limit: perPage\n      }, parsedFilter); // add header that Content-Range is in returned header\n\n\n      var options = {\n        headers: new Headers({\n          Accept: 'application/json',\n          Prefer: 'count=exact'\n        })\n      };\n      var url = apiUrl + \"/\" + resource + \"?\" + stringify(query);\n      return httpClient(url, options).then(function (_a) {\n        var headers = _a.headers,\n            json = _a.json;\n\n        if (!headers.has('content-range')) {\n          throw new Error(\"The Content-Range header is missing in the HTTP Response. The postgREST data provider expects \\n          responses for lists of resources to contain this header with the total number of results to build \\n          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?\");\n        }\n\n        return {\n          data: json,\n          total: parseInt(headers.get('content-range').split('/').pop(), 10)\n        };\n      });\n    },\n    getOne: function (resource, params) {\n      return httpClient(apiUrl + \"/\" + resource + \"?id=eq.\" + params.id, {\n        headers: new Headers({\n          'accept': 'application/vnd.pgrst.object+json'\n        })\n      }).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: json\n        };\n      });\n    },\n    getMany: function (resource, params) {\n      var ids = params.ids.join(\",\");\n      var url = apiUrl + \"/\" + resource + \"?id=in.(\" + ids + \")\";\n      return httpClient(url).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: json\n        };\n      });\n    },\n    getManyReference: function (resource, params) {\n      var _a;\n\n      var _b = params.pagination,\n          page = _b.page,\n          perPage = _b.perPage;\n      var _c = params.sort,\n          field = _c.field,\n          order = _c.order;\n      var parsedFilter = parseFilters(params.filter, defaultListOp);\n\n      var query = __assign((_a = {}, _a[params.target] = \"eq.\" + params.id, _a.order = field + \".\" + order.toLowerCase(), _a.offset = (page - 1) * perPage, _a.limit = perPage, _a), parsedFilter); // add header that Content-Range is in returned header\n\n\n      var options = {\n        headers: new Headers({\n          Accept: 'application/json',\n          Prefer: 'count=exact'\n        })\n      };\n      var url = apiUrl + \"/\" + resource + \"?\" + stringify(query);\n      return httpClient(url, options).then(function (_a) {\n        var headers = _a.headers,\n            json = _a.json;\n\n        if (!headers.has('content-range')) {\n          throw new Error(\"The Content-Range header is missing in the HTTP Response. The postgREST data provider expects \\n          responses for lists of resources to contain this header with the total number of results to build \\n          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?\");\n        }\n\n        return {\n          data: json,\n          total: parseInt(headers.get('content-range').split('/').pop(), 10)\n        };\n      });\n    },\n    update: function (resource, params) {\n      return httpClient(apiUrl + \"/\" + resource + \"?id=eq.\" + params.id, {\n        method: 'PATCH',\n        headers: new Headers({\n          'Accept': 'application/vnd.pgrst.object+json',\n          'Prefer': 'return=representation',\n          'Content-Type': 'application/json'\n        }),\n        body: JSON.stringify(params.data)\n      }).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: json\n        };\n      });\n    },\n    updateMany: function (resource, params) {\n      return httpClient(apiUrl + \"/\" + resource + \"?id=in.(\" + params.ids.join(',') + \")\", {\n        method: 'PATCH',\n        headers: new Headers({\n          'Prefer': 'return=representation',\n          'Content-Type': 'application/json'\n        }),\n        body: JSON.stringify(params.data)\n      }).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: json.map(function (data) {\n            return data.id;\n          })\n        };\n      });\n    },\n    create: function (resource, params) {\n      return httpClient(apiUrl + \"/\" + resource, {\n        method: 'POST',\n        headers: new Headers({\n          'Accept': 'application/vnd.pgrst.object+json',\n          'Prefer': 'return=representation',\n          'Content-Type': 'application/json'\n        }),\n        body: JSON.stringify(params.data)\n      }).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: __assign(__assign({}, params.data), {\n            id: json.id\n          })\n        };\n      });\n    },\n    delete: function (resource, params) {\n      return httpClient(apiUrl + \"/\" + resource + \"?id=eq.\" + params.id, {\n        method: 'DELETE',\n        headers: new Headers({\n          'Accept': 'application/vnd.pgrst.object+json',\n          'Prefer': 'return=representation',\n          'Content-Type': 'application/json'\n        })\n      }).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: json\n        };\n      });\n    },\n    deleteMany: function (resource, params) {\n      return httpClient(apiUrl + \"/\" + resource + \"?id=in.(\" + params.ids.join(',') + \")\", {\n        method: 'DELETE',\n        headers: new Headers({\n          'Prefer': 'return=representation',\n          'Content-Type': 'application/json'\n        })\n      }).then(function (_a) {\n        var json = _a.json;\n        return {\n          data: json.map(function (data) {\n            return data.id;\n          })\n        };\n      });\n    }\n  };\n});","map":{"version":3,"sources":["/home/codi/Entwicklung/workspace-webstorm/idendity-admin/node_modules/@raphiniert/ra-data-postgrest/esm/dataProvider/index.js"],"names":["__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","stringify","fetchUtils","parseFilters","filter","defaultListOp","result","keys","forEach","key","splitKey","split","operation","values","includes","trim","value","op","undefined","Array","isArray","push","apiUrl","httpClient","fetchJson","getList","resource","params","_a","pagination","page","perPage","_b","sort","field","order","parsedFilter","query","toLowerCase","offset","limit","options","headers","Headers","Accept","Prefer","url","then","json","has","Error","data","total","parseInt","get","pop","getOne","id","getMany","ids","join","getManyReference","_c","target","update","method","body","JSON","updateMany","map","create","delete","deleteMany"],"mappings":"AAAA,IAAIA,QAAQ,GAAI,QAAQ,KAAKA,QAAd,IAA2B,YAAY;AAClDA,EAAAA,QAAQ,GAAGC,MAAM,CAACC,MAAP,IAAiB,UAASC,CAAT,EAAY;AACpC,SAAK,IAAIC,CAAJ,EAAOC,CAAC,GAAG,CAAX,EAAcC,CAAC,GAAGC,SAAS,CAACC,MAAjC,EAAyCH,CAAC,GAAGC,CAA7C,EAAgDD,CAAC,EAAjD,EAAqD;AACjDD,MAAAA,CAAC,GAAGG,SAAS,CAACF,CAAD,CAAb;;AACA,WAAK,IAAII,CAAT,IAAcL,CAAd,EAAiB,IAAIH,MAAM,CAACS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACbN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AACP;;AACD,WAAON,CAAP;AACH,GAPD;;AAQA,SAAOH,QAAQ,CAACa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACH,CAVD;;AAWA,SAASO,SAAT,QAA0B,cAA1B;AACA,SAASC,UAAT,QAA2B,SAA3B;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA,SAASC,YAAT,CAAsBC,MAAtB,EAA8BC,aAA9B,EAA6C;AACzC,MAAIC,MAAM,GAAG,EAAb;AACAlB,EAAAA,MAAM,CAACmB,IAAP,CAAYH,MAAZ,EAAoBI,OAApB,CAA4B,UAAUC,GAAV,EAAe;AACvC;AACA,QAAIC,QAAQ,GAAGD,GAAG,CAACE,KAAJ,CAAU,GAAV,CAAf;AACA,QAAIC,SAAS,GAAGF,QAAQ,CAACf,MAAT,IAAmB,CAAnB,GAAuBe,QAAQ,CAAC,CAAD,CAA/B,GAAqCL,aAArD;AACA,QAAIQ,MAAJ;;AACA,QAAID,SAAS,CAACE,QAAV,CAAmB,MAAnB,CAAJ,EAAgC;AAC5B;AACAD,MAAAA,MAAM,GAAGT,MAAM,CAACK,GAAD,CAAN,CAAYM,IAAZ,GAAmBJ,KAAnB,CAAyB,GAAzB,CAAT;AACH,KAHD,MAIK;AACDE,MAAAA,MAAM,GAAG,CAACT,MAAM,CAACK,GAAD,CAAP,CAAT;AACH;;AACDI,IAAAA,MAAM,CAACL,OAAP,CAAe,UAAUQ,KAAV,EAAiB;AAC5B,UAAIC,EAAE,GAAGL,SAAS,CAACE,QAAV,CAAmB,MAAnB,IAA6BF,SAAS,GAAG,IAAZ,GAAmBI,KAAnB,GAA2B,GAAxD,GAA8DJ,SAAS,GAAG,GAAZ,GAAkBI,KAAzF;;AACA,UAAIV,MAAM,CAACI,QAAQ,CAAC,CAAD,CAAT,CAAN,KAAwBQ,SAA5B,EAAuC;AACnC;AACAZ,QAAAA,MAAM,CAACI,QAAQ,CAAC,CAAD,CAAT,CAAN,GAAsBO,EAAtB;AACH,OAHD,MAIK;AACD,YAAI,CAACE,KAAK,CAACC,OAAN,CAAcd,MAAM,CAACI,QAAQ,CAAC,CAAD,CAAT,CAApB,CAAL,EAAyC;AACrC;AACAJ,UAAAA,MAAM,CAACI,QAAQ,CAAC,CAAD,CAAT,CAAN,GAAsB,CAACJ,MAAM,CAACI,QAAQ,CAAC,CAAD,CAAT,CAAP,EAAsBO,EAAtB,CAAtB;AACH,SAHD,MAIK;AACD;AACAX,UAAAA,MAAM,CAACI,QAAQ,CAAC,CAAD,CAAT,CAAN,CAAoBW,IAApB,CAAyBJ,EAAzB;AACH;AACJ;AACJ,KAhBD;AAiBH,GA7BD;AA8BA,SAAOX,MAAP;AACH;;AACD,gBAAgB,UAAUgB,MAAV,EAAkBC,UAAlB,EAA8BlB,aAA9B,EAA6C;AACzD,MAAIkB,UAAU,KAAK,KAAK,CAAxB,EAA2B;AAAEA,IAAAA,UAAU,GAAGrB,UAAU,CAACsB,SAAxB;AAAoC;;AACjE,MAAInB,aAAa,KAAK,KAAK,CAA3B,EAA8B;AAAEA,IAAAA,aAAa,GAAG,IAAhB;AAAuB;;AACvD,SAAQ;AACJoB,IAAAA,OAAO,EAAE,UAAUC,QAAV,EAAoBC,MAApB,EAA4B;AACjC,UAAIC,EAAE,GAAGD,MAAM,CAACE,UAAhB;AAAA,UAA4BC,IAAI,GAAGF,EAAE,CAACE,IAAtC;AAAA,UAA4CC,OAAO,GAAGH,EAAE,CAACG,OAAzD;AACA,UAAIC,EAAE,GAAGL,MAAM,CAACM,IAAhB;AAAA,UAAsBC,KAAK,GAAGF,EAAE,CAACE,KAAjC;AAAA,UAAwCC,KAAK,GAAGH,EAAE,CAACG,KAAnD;AACA,UAAIC,YAAY,GAAGjC,YAAY,CAACwB,MAAM,CAACvB,MAAR,EAAgBC,aAAhB,CAA/B;;AACA,UAAIgC,KAAK,GAAGlD,QAAQ,CAAC;AAAEgD,QAAAA,KAAK,EAAED,KAAK,GAAG,GAAR,GAAcC,KAAK,CAACG,WAAN,EAAvB;AAA4CC,QAAAA,MAAM,EAAE,CAACT,IAAI,GAAG,CAAR,IAAaC,OAAjE;AAA0ES,QAAAA,KAAK,EAAET;AAAjF,OAAD,EAA6FK,YAA7F,CAApB,CAJiC,CAKjC;;;AACA,UAAIK,OAAO,GAAG;AACVC,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjBC,UAAAA,MAAM,EAAE,kBADS;AAEjBC,UAAAA,MAAM,EAAE;AAFS,SAAZ;AADC,OAAd;AAMA,UAAIC,GAAG,GAAGxB,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,GAA1B,GAAgCzB,SAAS,CAACoC,KAAD,CAAnD;AACA,aAAOd,UAAU,CAACuB,GAAD,EAAML,OAAN,CAAV,CAAyBM,IAAzB,CAA8B,UAAUnB,EAAV,EAAc;AAC/C,YAAIc,OAAO,GAAGd,EAAE,CAACc,OAAjB;AAAA,YAA0BM,IAAI,GAAGpB,EAAE,CAACoB,IAApC;;AACA,YAAI,CAACN,OAAO,CAACO,GAAR,CAAY,eAAZ,CAAL,EAAmC;AAC/B,gBAAM,IAAIC,KAAJ,CAAU,2UAAV,CAAN;AACH;;AACD,eAAO;AACHC,UAAAA,IAAI,EAAEH,IADH;AAEHI,UAAAA,KAAK,EAAEC,QAAQ,CAACX,OAAO,CAClBY,GADW,CACP,eADO,EAEX3C,KAFW,CAEL,GAFK,EAGX4C,GAHW,EAAD,EAGH,EAHG;AAFZ,SAAP;AAOH,OAZM,CAAP;AAaH,KA3BG;AA4BJC,IAAAA,MAAM,EAAE,UAAU9B,QAAV,EAAoBC,MAApB,EAA4B;AAChC,aAAOJ,UAAU,CAACD,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,SAA1B,GAAsCC,MAAM,CAAC8B,EAA9C,EAAkD;AAC/Df,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AAAE,oBAAU;AAAZ,SAAZ;AADsD,OAAlD,CAAV,CAEJI,IAFI,CAEC,UAAUnB,EAAV,EAAc;AAClB,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AACJG,UAAAA,IAAI,EAAEH;AADF,SAAR;AAGH,OAPM,CAAP;AAQH,KArCG;AAsCJU,IAAAA,OAAO,EAAE,UAAUhC,QAAV,EAAoBC,MAApB,EAA4B;AACjC,UAAIgC,GAAG,GAAGhC,MAAM,CAACgC,GAAP,CAAWC,IAAX,CAAgB,GAAhB,CAAV;AACA,UAAId,GAAG,GAAGxB,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,UAA1B,GAAuCiC,GAAvC,GAA6C,GAAvD;AACA,aAAOpC,UAAU,CAACuB,GAAD,CAAV,CAAgBC,IAAhB,CAAqB,UAAUnB,EAAV,EAAc;AACtC,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AAAEG,UAAAA,IAAI,EAAEH;AAAR,SAAR;AACH,OAHM,CAAP;AAIH,KA7CG;AA8CJa,IAAAA,gBAAgB,EAAE,UAAUnC,QAAV,EAAoBC,MAApB,EAA4B;AAC1C,UAAIC,EAAJ;;AACA,UAAII,EAAE,GAAGL,MAAM,CAACE,UAAhB;AAAA,UAA4BC,IAAI,GAAGE,EAAE,CAACF,IAAtC;AAAA,UAA4CC,OAAO,GAAGC,EAAE,CAACD,OAAzD;AACA,UAAI+B,EAAE,GAAGnC,MAAM,CAACM,IAAhB;AAAA,UAAsBC,KAAK,GAAG4B,EAAE,CAAC5B,KAAjC;AAAA,UAAwCC,KAAK,GAAG2B,EAAE,CAAC3B,KAAnD;AACA,UAAIC,YAAY,GAAGjC,YAAY,CAACwB,MAAM,CAACvB,MAAR,EAAgBC,aAAhB,CAA/B;;AACA,UAAIgC,KAAK,GAAGlD,QAAQ,EAAEyC,EAAE,GAAG,EAAL,EAASA,EAAE,CAACD,MAAM,CAACoC,MAAR,CAAF,GAAoB,QAAQpC,MAAM,CAAC8B,EAA5C,EAAgD7B,EAAE,CAACO,KAAH,GAAWD,KAAK,GAAG,GAAR,GAAcC,KAAK,CAACG,WAAN,EAAzE,EAA8FV,EAAE,CAACW,MAAH,GAAY,CAACT,IAAI,GAAG,CAAR,IAAaC,OAAvH,EAAgIH,EAAE,CAACY,KAAH,GAAWT,OAA3I,EAAoJH,EAAtJ,GAA2JQ,YAA3J,CAApB,CAL0C,CAM1C;;;AACA,UAAIK,OAAO,GAAG;AACVC,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjBC,UAAAA,MAAM,EAAE,kBADS;AAEjBC,UAAAA,MAAM,EAAE;AAFS,SAAZ;AADC,OAAd;AAMA,UAAIC,GAAG,GAAGxB,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,GAA1B,GAAgCzB,SAAS,CAACoC,KAAD,CAAnD;AACA,aAAOd,UAAU,CAACuB,GAAD,EAAML,OAAN,CAAV,CAAyBM,IAAzB,CAA8B,UAAUnB,EAAV,EAAc;AAC/C,YAAIc,OAAO,GAAGd,EAAE,CAACc,OAAjB;AAAA,YAA0BM,IAAI,GAAGpB,EAAE,CAACoB,IAApC;;AACA,YAAI,CAACN,OAAO,CAACO,GAAR,CAAY,eAAZ,CAAL,EAAmC;AAC/B,gBAAM,IAAIC,KAAJ,CAAU,2UAAV,CAAN;AACH;;AACD,eAAO;AACHC,UAAAA,IAAI,EAAEH,IADH;AAEHI,UAAAA,KAAK,EAAEC,QAAQ,CAACX,OAAO,CAClBY,GADW,CACP,eADO,EAEX3C,KAFW,CAEL,GAFK,EAGX4C,GAHW,EAAD,EAGH,EAHG;AAFZ,SAAP;AAOH,OAZM,CAAP;AAaH,KAzEG;AA0EJS,IAAAA,MAAM,EAAE,UAAUtC,QAAV,EAAoBC,MAApB,EAA4B;AAChC,aAAOJ,UAAU,CAACD,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,SAA1B,GAAsCC,MAAM,CAAC8B,EAA9C,EAAkD;AAC/DQ,QAAAA,MAAM,EAAE,OADuD;AAE/DvB,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjB,oBAAU,mCADO;AAEjB,oBAAU,uBAFO;AAGjB,0BAAgB;AAHC,SAAZ,CAFsD;AAO/DuB,QAAAA,IAAI,EAAEC,IAAI,CAAClE,SAAL,CAAe0B,MAAM,CAACwB,IAAtB;AAPyD,OAAlD,CAAV,CAQJJ,IARI,CAQC,UAAUnB,EAAV,EAAc;AAClB,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AAAEG,UAAAA,IAAI,EAAEH;AAAR,SAAR;AACH,OAXM,CAAP;AAYH,KAvFG;AAwFJoB,IAAAA,UAAU,EAAE,UAAU1C,QAAV,EAAoBC,MAApB,EAA4B;AACpC,aAAOJ,UAAU,CAACD,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,UAA1B,GAAuCC,MAAM,CAACgC,GAAP,CAAWC,IAAX,CAAgB,GAAhB,CAAvC,GAA8D,GAA/D,EAAoE;AACjFK,QAAAA,MAAM,EAAE,OADyE;AAEjFvB,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjB,oBAAU,uBADO;AAEjB,0BAAgB;AAFC,SAAZ,CAFwE;AAMjFuB,QAAAA,IAAI,EAAEC,IAAI,CAAClE,SAAL,CAAe0B,MAAM,CAACwB,IAAtB;AAN2E,OAApE,CAAV,CAOJJ,IAPI,CAOC,UAAUnB,EAAV,EAAc;AAClB,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AAAEG,UAAAA,IAAI,EAAEH,IAAI,CAACqB,GAAL,CAAS,UAAUlB,IAAV,EAAgB;AAAE,mBAAOA,IAAI,CAACM,EAAZ;AAAiB,WAA5C;AAAR,SAAR;AACH,OAVM,CAAP;AAWH,KApGG;AAqGJa,IAAAA,MAAM,EAAE,UAAU5C,QAAV,EAAoBC,MAApB,EAA4B;AAChC,aAAOJ,UAAU,CAACD,MAAM,GAAG,GAAT,GAAeI,QAAhB,EAA0B;AACvCuC,QAAAA,MAAM,EAAE,MAD+B;AAEvCvB,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjB,oBAAU,mCADO;AAEjB,oBAAU,uBAFO;AAGjB,0BAAgB;AAHC,SAAZ,CAF8B;AAOvCuB,QAAAA,IAAI,EAAEC,IAAI,CAAClE,SAAL,CAAe0B,MAAM,CAACwB,IAAtB;AAPiC,OAA1B,CAAV,CAQJJ,IARI,CAQC,UAAUnB,EAAV,EAAc;AAClB,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AAAEG,UAAAA,IAAI,EAAEhE,QAAQ,CAACA,QAAQ,CAAC,EAAD,EAAKwC,MAAM,CAACwB,IAAZ,CAAT,EAA4B;AAAEM,YAAAA,EAAE,EAAET,IAAI,CAACS;AAAX,WAA5B;AAAhB,SAAR;AACH,OAXM,CAAP;AAYH,KAlHG;AAmHJc,IAAAA,MAAM,EAAE,UAAU7C,QAAV,EAAoBC,MAApB,EAA4B;AAChC,aAAOJ,UAAU,CAACD,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,SAA1B,GAAsCC,MAAM,CAAC8B,EAA9C,EAAkD;AAC/DQ,QAAAA,MAAM,EAAE,QADuD;AAE/DvB,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjB,oBAAU,mCADO;AAEjB,oBAAU,uBAFO;AAGjB,0BAAgB;AAHC,SAAZ;AAFsD,OAAlD,CAAV,CAOJI,IAPI,CAOC,UAAUnB,EAAV,EAAc;AAClB,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AAAEG,UAAAA,IAAI,EAAEH;AAAR,SAAR;AACH,OAVM,CAAP;AAWH,KA/HG;AAgIJwB,IAAAA,UAAU,EAAE,UAAU9C,QAAV,EAAoBC,MAApB,EAA4B;AACpC,aAAOJ,UAAU,CAACD,MAAM,GAAG,GAAT,GAAeI,QAAf,GAA0B,UAA1B,GAAuCC,MAAM,CAACgC,GAAP,CAAWC,IAAX,CAAgB,GAAhB,CAAvC,GAA8D,GAA/D,EAAoE;AACjFK,QAAAA,MAAM,EAAE,QADyE;AAEjFvB,QAAAA,OAAO,EAAE,IAAIC,OAAJ,CAAY;AACjB,oBAAU,uBADO;AAEjB,0BAAgB;AAFC,SAAZ;AAFwE,OAApE,CAAV,CAMJI,IANI,CAMC,UAAUnB,EAAV,EAAc;AAClB,YAAIoB,IAAI,GAAGpB,EAAE,CAACoB,IAAd;AACA,eAAQ;AAAEG,UAAAA,IAAI,EAAEH,IAAI,CAACqB,GAAL,CAAS,UAAUlB,IAAV,EAAgB;AAAE,mBAAOA,IAAI,CAACM,EAAZ;AAAiB,WAA5C;AAAR,SAAR;AACH,OATM,CAAP;AAUH;AA3IG,GAAR;AA6IH,CAhJD","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nimport { stringify } from 'query-string';\nimport { fetchUtils } from 'ra-core';\n/**\n * Maps react-admin queries to a postgrest REST API\n *\n * This REST dialect uses postgrest syntax\n *\n * @see https://postgrest.org/en/v6.0/api.html#embedded-filters\n *\n * @example\n *\n * getList          => GET    http://my.api.url/posts?order=title.asc&offset=0&limit=24&filterField=eq.value\n * getOne           => GET    http://my.api.url/posts?id=eq.123\n * getMany          => GET    http://my.api.url/posts?id=in.(123,456,789)\n * getManyReference => GET    http://my.api.url/posts?author_id=eq.345\n * create           => POST   http://my.api.url/posts\n * update           => PATCH  http://my.api.url/posts?id=eq.123\n * updateMany       => PATCH  http://my.api.url/posts?id=in.(123,456,789)\n * delete           => DELETE http://my.api.url/posts?id=eq.123\n * deleteMany       => DELETE http://my.api.url/posts?id=in.(123,456,789)\n *\n * @example\n *\n * import React from 'react';\n * import { Admin, Resource } from 'react-admin';\n * import postgrestRestProvider from '@raphiniert/ra-data-postgrest';\n *\n * import { PostList } from './posts';\n *\n * const App = () => (\n *     <Admin dataProvider={postgrestRestProvider('http://path.to.my.api/')}>\n *         <Resource name=\"posts\" list={PostList} />\n *     </Admin>\n * );\n *\n * export default App;\n */\nfunction parseFilters(filter, defaultListOp) {\n    var result = {};\n    Object.keys(filter).forEach(function (key) {\n        // key: the name of the object key\n        var splitKey = key.split('@');\n        var operation = splitKey.length == 2 ? splitKey[1] : defaultListOp;\n        var values;\n        if (operation.includes('like')) {\n            // we split the search term in words\n            values = filter[key].trim().split(' ');\n        }\n        else {\n            values = [filter[key]];\n        }\n        values.forEach(function (value) {\n            var op = operation.includes('like') ? operation + \".*\" + value + \"*\" : operation + \".\" + value;\n            if (result[splitKey[0]] === undefined) {\n                // first operator for the key, we add it to the dict\n                result[splitKey[0]] = op;\n            }\n            else {\n                if (!Array.isArray(result[splitKey[0]])) {\n                    // second operator, we transform to an array\n                    result[splitKey[0]] = [result[splitKey[0]], op];\n                }\n                else {\n                    // third and subsequent, we add to array\n                    result[splitKey[0]].push(op);\n                }\n            }\n        });\n    });\n    return result;\n}\nexport default (function (apiUrl, httpClient, defaultListOp) {\n    if (httpClient === void 0) { httpClient = fetchUtils.fetchJson; }\n    if (defaultListOp === void 0) { defaultListOp = 'eq'; }\n    return ({\n        getList: function (resource, params) {\n            var _a = params.pagination, page = _a.page, perPage = _a.perPage;\n            var _b = params.sort, field = _b.field, order = _b.order;\n            var parsedFilter = parseFilters(params.filter, defaultListOp);\n            var query = __assign({ order: field + \".\" + order.toLowerCase(), offset: (page - 1) * perPage, limit: perPage }, parsedFilter);\n            // add header that Content-Range is in returned header\n            var options = {\n                headers: new Headers({\n                    Accept: 'application/json',\n                    Prefer: 'count=exact'\n                })\n            };\n            var url = apiUrl + \"/\" + resource + \"?\" + stringify(query);\n            return httpClient(url, options).then(function (_a) {\n                var headers = _a.headers, json = _a.json;\n                if (!headers.has('content-range')) {\n                    throw new Error(\"The Content-Range header is missing in the HTTP Response. The postgREST data provider expects \\n          responses for lists of resources to contain this header with the total number of results to build \\n          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?\");\n                }\n                return {\n                    data: json,\n                    total: parseInt(headers\n                        .get('content-range')\n                        .split('/')\n                        .pop(), 10)\n                };\n            });\n        },\n        getOne: function (resource, params) {\n            return httpClient(apiUrl + \"/\" + resource + \"?id=eq.\" + params.id, {\n                headers: new Headers({ 'accept': 'application/vnd.pgrst.object+json' }),\n            }).then(function (_a) {\n                var json = _a.json;\n                return ({\n                    data: json,\n                });\n            });\n        },\n        getMany: function (resource, params) {\n            var ids = params.ids.join(\",\");\n            var url = apiUrl + \"/\" + resource + \"?id=in.(\" + ids + \")\";\n            return httpClient(url).then(function (_a) {\n                var json = _a.json;\n                return ({ data: json });\n            });\n        },\n        getManyReference: function (resource, params) {\n            var _a;\n            var _b = params.pagination, page = _b.page, perPage = _b.perPage;\n            var _c = params.sort, field = _c.field, order = _c.order;\n            var parsedFilter = parseFilters(params.filter, defaultListOp);\n            var query = __assign((_a = {}, _a[params.target] = \"eq.\" + params.id, _a.order = field + \".\" + order.toLowerCase(), _a.offset = (page - 1) * perPage, _a.limit = perPage, _a), parsedFilter);\n            // add header that Content-Range is in returned header\n            var options = {\n                headers: new Headers({\n                    Accept: 'application/json',\n                    Prefer: 'count=exact'\n                })\n            };\n            var url = apiUrl + \"/\" + resource + \"?\" + stringify(query);\n            return httpClient(url, options).then(function (_a) {\n                var headers = _a.headers, json = _a.json;\n                if (!headers.has('content-range')) {\n                    throw new Error(\"The Content-Range header is missing in the HTTP Response. The postgREST data provider expects \\n          responses for lists of resources to contain this header with the total number of results to build \\n          the pagination. If you are using CORS, did you declare Content-Range in the Access-Control-Expose-Headers header?\");\n                }\n                return {\n                    data: json,\n                    total: parseInt(headers\n                        .get('content-range')\n                        .split('/')\n                        .pop(), 10),\n                };\n            });\n        },\n        update: function (resource, params) {\n            return httpClient(apiUrl + \"/\" + resource + \"?id=eq.\" + params.id, {\n                method: 'PATCH',\n                headers: new Headers({\n                    'Accept': 'application/vnd.pgrst.object+json',\n                    'Prefer': 'return=representation',\n                    'Content-Type': 'application/json'\n                }),\n                body: JSON.stringify(params.data),\n            }).then(function (_a) {\n                var json = _a.json;\n                return ({ data: json });\n            });\n        },\n        updateMany: function (resource, params) {\n            return httpClient(apiUrl + \"/\" + resource + \"?id=in.(\" + params.ids.join(',') + \")\", {\n                method: 'PATCH',\n                headers: new Headers({\n                    'Prefer': 'return=representation',\n                    'Content-Type': 'application/json',\n                }),\n                body: JSON.stringify(params.data),\n            }).then(function (_a) {\n                var json = _a.json;\n                return ({ data: json.map(function (data) { return data.id; }) });\n            });\n        },\n        create: function (resource, params) {\n            return httpClient(apiUrl + \"/\" + resource, {\n                method: 'POST',\n                headers: new Headers({\n                    'Accept': 'application/vnd.pgrst.object+json',\n                    'Prefer': 'return=representation',\n                    'Content-Type': 'application/json'\n                }),\n                body: JSON.stringify(params.data),\n            }).then(function (_a) {\n                var json = _a.json;\n                return ({ data: __assign(__assign({}, params.data), { id: json.id }) });\n            });\n        },\n        delete: function (resource, params) {\n            return httpClient(apiUrl + \"/\" + resource + \"?id=eq.\" + params.id, {\n                method: 'DELETE',\n                headers: new Headers({\n                    'Accept': 'application/vnd.pgrst.object+json',\n                    'Prefer': 'return=representation',\n                    'Content-Type': 'application/json'\n                }),\n            }).then(function (_a) {\n                var json = _a.json;\n                return ({ data: json });\n            });\n        },\n        deleteMany: function (resource, params) {\n            return httpClient(apiUrl + \"/\" + resource + \"?id=in.(\" + params.ids.join(',') + \")\", {\n                method: 'DELETE',\n                headers: new Headers({\n                    'Prefer': 'return=representation',\n                    'Content-Type': 'application/json'\n                }),\n            }).then(function (_a) {\n                var json = _a.json;\n                return ({ data: json.map(function (data) { return data.id; }) });\n            });\n        },\n    });\n});\n"]},"metadata":{},"sourceType":"module"}